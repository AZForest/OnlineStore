{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _objectSpread from\"/Users/alexforest/Desktop/OnlineStore/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/alexforest/Desktop/OnlineStore/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/alexforest/Desktop/OnlineStore/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/alexforest/Desktop/OnlineStore/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/alexforest/Desktop/OnlineStore/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import classes from'./Cart.module.css';import{connect}from'react-redux';import CartItem from'../../../components/UI/CartItem/CartItem';import Modal from'../../../components/UI/Modal/Modal';import axios from'axios';import*as actionTypes from'../../../store/actions/actionTypes';var Cart=/*#__PURE__*/function(_React$Component){_inherits(Cart,_React$Component);var _super=_createSuper(Cart);function Cart(){var _this;_classCallCheck(this,Cart);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={modalVisible:false,totalPrice:0,user:0};_this.removeHandler=function(name,price){var data={prevCart:_this.props.user.cart,product:{name:name,price:price,count:1},updateCount:false};var cartArray=_this.props.user.cart;var index2=-1;for(var i=0;i<cartArray.length;i++){if(cartArray[i].name===data.product.name){index2=i;if(cartArray[i].count>1){data.updateCount=true;}}}if(!data.updateCount){if(index2>=0){cartArray.splice(index2,1);}}else{cartArray[index2].count-=1;}var updatedAcc=_objectSpread(_objectSpread({},_this.props.user),{},{cart:cartArray});//PATCH remove\naxios.patch(\"http://localhost:3005/users/\".concat(_this.props.user.id,\"/removeProduct\"),data).then(function(response){console.log(response);_this.props.onUpdateCart(updatedAcc);}).catch(function(err){console.log(err);});};return _this;}_createClass(Cart,[{key:\"componentDidMount\",value:function componentDidMount(){if(localStorage.getItem('user')!==null){axios.get('http://localhost:3005/users').then(function(response){for(var i=0;i<response.data.length;i++){//console.log(localStorage.getItem('user'));\nif(response.data[i].userName===localStorage.getItem('user')){/* this.props.onAuth(response.data[i].userName, response.data[i].password, response.data[i].orders, response.data[i].cart, response.data[i]._id); */}}});}}},{key:\"addHandler\",value:function addHandler(name,price){var _this2=this;var data={prevCart:this.props.user.cart,product:{name:name,price:price,count:1},updateCount:true};//Determines if item exists in cart and count needs to be updated\nfor(var i=0;i<data.prevCart.length;i++){if(data.prevCart[i].name===data.product.name){data.updateCount=true;}}var updatedAcc;if(!data.updateCount){updatedAcc=_objectSpread(_objectSpread({},this.props.user),{},{cart:this.props.user.cart.concat(data.product)});}else{var element;for(var _i=0;_i<this.props.user.cart.length;_i++){if(this.props.user.cart[_i].name===data.product.name){element=_i;}}var newAcc=this.props.user.cart;newAcc[element].count+=1;updatedAcc=_objectSpread(_objectSpread({},this.props.user),{},{cart:newAcc});}axios.patch(\"http://localhost:3005/users/\".concat(this.props.user.id,\"/addProduct\"),data).then(function(response){console.log(response);_this2.props.onUpdateCart(updatedAcc);}).catch(function(err){console.log(err);});}},{key:\"finalizeOrder\",value:function finalizeOrder(total){var _this3=this;var data={prevOrders:this.props.user.orders,newOrder:{items:this.props.user.cart,totalPrice:total,date:new Date(),id:Math.random()}};var newOrders=this.props.user.orders;newOrders.push(data.newOrder);var updatedAcc=_objectSpread(_objectSpread({},this.props.user),{},{orders:newOrders,cart:[]});axios.patch(\"http://localhost:3005/users/\".concat(this.props.user.id,\"/addOrder\"),data).then(function(response){console.log(response);_this3.setModalVisible();axios.patch(\"http://localhost:3005/users/\".concat(_this3.props.user.id,\"/resetCart\")).then(function(response){console.log(response);_this3.props.onUpdateCart(updatedAcc);}).catch(function(err){return console.log(err);});/* this.props.onResetCart({\n                ...this.props.user,\n                cart: []\n            }); */window.alert('Your order has been placed. Check your account page to view completed orders.');_this3.props.history.push('/');}).catch(function(err){console.log(err);});}},{key:\"setModalVisible\",value:function setModalVisible(){this.setState({modalVisible:!this.state.modalVisible});}},{key:\"render\",value:function render(){var _this4=this;var totalItems=0;var price=0;if(this.props.user!==null){for(var i=0;i<this.props.user.cart.length;i++){totalItems+=this.props.user.cart[i].count;price+=this.props.user.cart[i].price*this.props.user.cart[i].count;}}var modal=\"\";var message=\"Place order for $\".concat(price.toFixed(2),\"?\");if(this.state.modalVisible){modal=/*#__PURE__*/_jsx(Modal,{message:message,xClick:function xClick(){return _this4.setModalVisible();},order:function order(){return _this4.finalizeOrder(price.toFixed(2));}});}return/*#__PURE__*/_jsxs(React.Fragment,{children:[modal,/*#__PURE__*/_jsxs(\"div\",{className:classes.Cart,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your Cart\"}),this.props.user.cart.map(function(item){return/*#__PURE__*/_jsx(CartItem,{name:item.name,price:item.price,count:item.count,add:function add(){return _this4.addHandler(item.name,item.price);},remove:function remove(){return _this4.removeHandler(item.name,item.price);}},Math.random());}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"Total Items: \",totalItems]}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"Price: $\",price.toFixed(2),\" \"]}),/*#__PURE__*/_jsx(\"button\",{className:classes.button,onClick:function onClick(){return _this4.setModalVisible();},style:this.props.user.cart.length===0?{marginBottom:\"170px\"}:{marginBottom:\"10px\"},disabled:this.props.user.cart.length>0?false:true,children:\"Place Order\"})]})]})]});}}]);return Cart;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{user:state.activeUser};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{onUpdateCart:function onUpdateCart(account){return dispatch({type:actionTypes.UPDATE_CART,account:account});},onResetCart:function onResetCart(cart){return dispatch({type:actionTypes.RESET_CART,cart:cart});},onAuth:function onAuth(name,password,orders,cart,id){return dispatch({type:actionTypes.ACTIVATE_USER,userData:{userName:name,password:password,orders:orders,cart:cart,id:id}});}};};export default connect(mapStateToProps,mapDispatchToProps)(Cart);/* export const Cart = connect(mapStateToProps, mapDispatchToProps)(Cart);\nexport const removeHandler = () => this.removeHandler(); */","map":{"version":3,"sources":["/Users/alexforest/Desktop/OnlineStore/src/containers/User/Cart/Cart.js"],"names":["React","classes","connect","CartItem","Modal","axios","actionTypes","Cart","state","modalVisible","totalPrice","user","removeHandler","name","price","data","prevCart","props","cart","product","count","updateCount","cartArray","index2","i","length","splice","updatedAcc","patch","id","then","response","console","log","onUpdateCart","catch","err","localStorage","getItem","get","userName","concat","element","newAcc","total","prevOrders","orders","newOrder","items","date","Date","Math","random","newOrders","push","setModalVisible","window","alert","history","setState","totalItems","modal","message","toFixed","finalizeOrder","map","item","addHandler","button","marginBottom","Component","mapStateToProps","activeUser","mapDispatchToProps","dispatch","account","type","UPDATE_CART","onResetCart","RESET_CART","onAuth","password","ACTIVATE_USER","userData"],"mappings":"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","sourcesContent":["import React from 'react';\nimport classes from './Cart.module.css';\nimport { connect } from 'react-redux';\nimport CartItem from '../../../components/UI/CartItem/CartItem';\nimport Modal from '../../../components/UI/Modal/Modal';\nimport axios from 'axios';\nimport * as actionTypes from '../../../store/actions/actionTypes';\n\nclass Cart extends React.Component {\n\n    state = {\n        modalVisible: false,\n        totalPrice: 0,\n        user: 0\n    }\n\n    componentDidMount() {\n        if (localStorage.getItem('user') !== null) {\n            axios.get('http://localhost:3005/users')\n            .then(response => {\n              for (let i = 0; i < response.data.length; i++) {\n                //console.log(localStorage.getItem('user'));\n                if (response.data[i].userName === localStorage.getItem('user')) {\n                  /* this.props.onAuth(response.data[i].userName, response.data[i].password, response.data[i].orders, response.data[i].cart, response.data[i]._id); */\n                }\n              }\n            })\n        }\n    }\n\n    addHandler(name, price) {\n        let data = {\n            prevCart: this.props.user.cart,\n            product: {\n                name: name,\n                price: price,\n                count: 1\n            },\n            updateCount: true\n        }\n        \n        //Determines if item exists in cart and count needs to be updated\n        for (let i = 0; i < data.prevCart.length; i++) {\n            if (data.prevCart[i].name === data.product.name) {\n                data.updateCount = true;\n            }\n        }\n\n        let updatedAcc;\n        if (!data.updateCount) {\n            updatedAcc = {\n                ...this.props.user,\n                cart: this.props.user.cart.concat(data.product)\n            }\n        } else {\n            let element;\n            for (let i = 0; i < this.props.user.cart.length; i++) {\n                if (this.props.user.cart[i].name === data.product.name) {\n                    element = i;\n                }\n            }\n            let newAcc = this.props.user.cart;\n            newAcc[element].count += 1;\n            updatedAcc = {\n                ...this.props.user,\n                cart: newAcc\n            }\n        }\n\n\n        axios.patch(`http://localhost:3005/users/${this.props.user.id}/addProduct`, data)\n        .then(response => {\n            console.log(response);\n            this.props.onUpdateCart(updatedAcc);\n        })\n        .catch(err => {\n            console.log(err);\n        })\n    }\n\n    removeHandler = (name, price) => {\n        let data = {\n            prevCart: this.props.user.cart,\n            product: {\n                name: name,\n                price: price,\n                count: 1\n            },\n            updateCount: false\n        }\n        let cartArray = this.props.user.cart;\n\n        let index2 = -1;\n        for (let i = 0; i < cartArray.length; i++) {\n            if (cartArray[i].name === data.product.name) {\n                index2 = i;\n                if (cartArray[i].count > 1) {\n                    data.updateCount = true\n                }\n            }\n        }\n        if (!data.updateCount) {\n            if (index2 >= 0) {\n                cartArray.splice(index2, 1);\n            }\n        } else {\n            cartArray[index2].count -= 1\n        }\n\n        let updatedAcc = {\n            ...this.props.user,\n            cart: cartArray\n        }\n       \n        //PATCH remove\n        axios.patch(`http://localhost:3005/users/${this.props.user.id}/removeProduct`, data)\n        .then(response => {\n            console.log(response);\n            this.props.onUpdateCart(updatedAcc);\n        })\n        .catch(err => {\n            console.log(err);\n        })\n        \n    }\n\n    finalizeOrder(total) {\n        let data = {\n            prevOrders: this.props.user.orders,\n            newOrder: { \n                items: this.props.user.cart,\n                totalPrice: total,\n                date: new Date(),\n                id: Math.random()\n            }\n        }\n        let newOrders = this.props.user.orders;\n        newOrders.push(data.newOrder);\n\n        let updatedAcc = {\n            ...this.props.user,\n            orders: newOrders,\n            cart: []\n        }\n\n        axios.patch(`http://localhost:3005/users/${this.props.user.id}/addOrder`, data)\n        .then(response => {\n            console.log(response);\n            this.setModalVisible();\n            axios.patch(`http://localhost:3005/users/${this.props.user.id}/resetCart`)\n            .then(response => {\n                console.log(response);\n                this.props.onUpdateCart(updatedAcc);\n            })\n            .catch(err => console.log(err))\n            /* this.props.onResetCart({\n                ...this.props.user,\n                cart: []\n            }); */\n            window.alert('Your order has been placed. Check your account page to view completed orders.');\n            this.props.history.push('/');\n\n        })\n        .catch(err => {\n            console.log(err);\n        })\n        \n    }\n\n    setModalVisible() {\n        this.setState({modalVisible: !this.state.modalVisible})\n    }\n\n    render() {\n        let totalItems = 0;\n        let price = 0;\n        if (this.props.user !== null) {\n            for (let i = 0; i < this.props.user.cart.length; i++) {\n                totalItems += this.props.user.cart[i].count;\n                price += this.props.user.cart[i].price * this.props.user.cart[i].count\n            }\n        }\n\n        let modal = \"\";\n        let message = `Place order for $${price.toFixed(2)}?`\n        if (this.state.modalVisible) {\n            modal = <Modal message={message} xClick={() => this.setModalVisible()} order={() => this.finalizeOrder(price.toFixed(2))}/>;\n        }\n\n        return (\n            <React.Fragment>\n                {modal}\n                <div className={classes.Cart}>\n                    <h2 >Your Cart</h2>\n                    {this.props.user.cart.map(item => {\n                        return <CartItem \n                        key={Math.random()} \n                        name={item.name} \n                        price={item.price}\n                        count={item.count} \n                        add={() => this.addHandler(item.name, item.price)}\n                        remove={() => this.removeHandler(item.name, item.price)}/>\n                    })}\n                    <hr />\n                    <div>\n                        <h4>Total Items: {totalItems}</h4>\n                        <h4>Price: ${price.toFixed(2)} </h4>\n                        <button className={classes.button} onClick={() => this.setModalVisible()} style={this.props.user.cart.length === 0 ? {marginBottom: \"170px\"} : {marginBottom: \"10px\"}} disabled={this.props.user.cart.length > 0 ? false : true}>Place Order</button>\n                    </div>\n                </div>\n            </React.Fragment>\n        )\n    }\n}\n\nconst mapStateToProps = state => {\n    return {\n        user: state.activeUser\n    }\n}\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        onUpdateCart: (account) => dispatch({type: actionTypes.UPDATE_CART, account}),\n        onResetCart: (cart) => dispatch({type: actionTypes.RESET_CART, cart}),\n        onAuth: (name, password, orders, cart, id) => dispatch({type: actionTypes.ACTIVATE_USER, userData: { userName: name, password: password, orders: orders, cart: cart, id: id } })\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Cart);\n\n/* export const Cart = connect(mapStateToProps, mapDispatchToProps)(Cart);\nexport const removeHandler = () => this.removeHandler(); */"]},"metadata":{},"sourceType":"module"}